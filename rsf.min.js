!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof module&&module.exports?module.exports=e():t.rsf=e()}("undefined"!=typeof self?self:this,function(){return function(t,e,r={}){const n=["checked","disabled","required","readonly","selected","multiple","hidden","open","novalidate","autoplay","controls","default","reversed","async","defer"],s=["click","dblclick","mousedown","mouseup","mouseover","mouseout","mousemove","keydown","keyup","keypress","focus","blur","change","submit","input","touchstart","touchend","touchmove","drag","dragstart","dragend","dragover","dragenter","dragleave","drop"];let i=0;const o={anchor:t,child:e,options:r,_element:null,_currentElement:null,_stack:[],State:class{constructor(t,e={}){this._value=t,this._compare=e.compare||((t,e)=>t===e),this._debug=e.debug||!1}get(){return this._value}set(t,e){this._compare(this._value,t)&&!e||(this._value=t,this.notifyElements())}get value(){return this._value}set value(t){this.set(t)}update(t,e){const r=t(this.get());return this.set(r,e),this}notifyElements(){document.querySelectorAll("[data-rsf-watching]").forEach(t=>{if(t.getAttribute("data-rsf-watching").split(",").includes(this._stateId)){const e=t._rsfRender;if(e){t.innerHTML="";const r=Object.create(o);r._currentElement=t,e(r)}}})}},init(){if(this._element=document.querySelector(this.anchor),!this._element)throw new Error(`RSF: Cannot find anchor element "${this.anchor}"`);return this._currentElement=this._element,this},elem(t="div",e={},r){const o=document.createElement(t),a=r;if(e.watch){const t=Array.isArray(e.watch)?e.watch:[e.watch];t.forEach(t=>{t._stateId||(t._stateId="state-"+i++)}),o.setAttribute("data-rsf-watching",t.map(t=>t._stateId).join(",")),o._rsfRender=a,delete e.watch}if(Object.entries(e).forEach(([t,e])=>{const r=t.replace(/[A-Z]/g,t=>`-${t.toLowerCase()}`);"class"===t?o.className=e:"style"===t?"object"==typeof e?Object.assign(o.style,e):o.setAttribute("style",e):s.includes(r)?o.addEventListener(r,t=>{e.prototype?e.call(o,t,this):e(t,this)}):n.includes(r)?!0===e?o.setAttribute(r,""):!1===e&&o.removeAttribute(r):o.setAttribute(r,e)}),this._currentElement.appendChild(o),"function"==typeof a){this._stack.push(this._currentElement);const t=this._currentElement;this._currentElement=o,this._parentElement=t,a(this),this._currentElement=this._stack.pop(),this._parentElement=this._stack[this._stack.length-1]||null}else if(void 0!==a){const t=String(a);!0===e.html?o.innerHTML=t:o.textContent=t}return o},text(t){const e=document.createTextNode(String(t));return this._currentElement.appendChild(e),e},render(){return this.init(),this._element.innerHTML="",this.child(this),this}};return["address","article","aside","footer","header","h1","h2","h3","h4","h5","h6","main","nav","section","blockquote","dd","div","dl","dt","figcaption","figure","hr","li","ol","p","pre","ul","a","abbr","b","bdi","bdo","br","cite","code","data","dfn","em","i","kbd","mark","q","rp","rt","ruby","s","samp","small","span","strong","sub","sup","time","u","var","img","audio","video","track","table","caption","col","colgroup","tbody","td","tfoot","th","thead","tr","button","datalist","fieldset","form","input","label","legend","meter","optgroup","option","output","progress","select","textarea","canvas","svg","circle","rect","text","path","iframe"].forEach(t=>{"text"!==t&&(o[t]=function(e,r){return"string"==typeof e||"function"==typeof e?this.elem(t,{},e):this.elem(t,e||{},r)})}),r.addTags&&Array.isArray(r.addTags)&&r.addTags.forEach(t=>{o[t]=function(e,r){return"string"==typeof e||"function"==typeof e?this.elem(t,{},e):this.elem(t,e||{},r)}}),o.render()}});